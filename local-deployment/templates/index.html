<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True-Asset-ALLUSE - Local Deployment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        .grid-pattern {
            background-image: radial-gradient(circle, rgba(20, 184, 166, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen grid-pattern" x-data="app()">
    <!-- Login Screen -->
    <div x-show="!isLoggedIn" class="min-h-screen flex items-center justify-center">
        <div class="bg-slate-800 p-8 rounded-lg border border-slate-700 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-teal-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    <h1 class="text-2xl font-bold">TRUE-ASSET-ALLUSE</h1>
                </div>
                <p class="text-slate-400">Intelligent Wealth Management Platform</p>
                <p class="text-sm text-teal-400 mt-2">Local Deployment</p>
            </div>
            
            <form @submit.prevent="login()">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" x-model="credentials.username" 
                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                           placeholder="Enter your username" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" x-model="credentials.password"
                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                           placeholder="Enter your password" required>
                </div>
                
                <button type="submit" 
                        class="w-full bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                    Sign In
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-slate-400">
                Demo credentials: admin / password
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div x-show="isLoggedIn" class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-slate-800 border-r border-slate-700">
            <div class="p-4 border-b border-slate-700">
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-teal-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    <span class="font-bold">TRUE-ASSET-ALLUSE</span>
                </div>
            </div>
            
            <nav class="p-4">
                <button @click="currentView = 'dashboard'" 
                        :class="currentView === 'dashboard' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    üìä Dashboard
                </button>
                <button @click="currentView = 'trading'" 
                        :class="currentView === 'trading' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    üìà Trading
                </button>
                <button @click="currentView = 'accounts'" 
                        :class="currentView === 'accounts' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    üè¶ Accounts
                </button>
                <button @click="currentView = 'risk'" 
                        :class="currentView === 'risk' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    üõ°Ô∏è Risk Management
                </button>
                <button @click="currentView = 'ai'" 
                        :class="currentView === 'ai' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    ü§ñ AI Assistant
                </button>
                <button @click="currentView = 'settings'" 
                        :class="currentView === 'settings' ? 'bg-teal-600' : 'hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-md mb-2 transition duration-200">
                    ‚öôÔ∏è Settings
                </button>
            </nav>
            
            <!-- Protocol Level Indicator -->
            <div class="absolute bottom-4 left-4 right-4">
                <div class="bg-slate-700 p-3 rounded-md">
                    <div class="text-sm text-slate-400 mb-1">Protocol Level</div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                        <span class="text-green-400 font-medium">Normal</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <div class="bg-slate-800 border-b border-slate-700 p-4 flex justify-between items-center">
                <h2 class="text-xl font-semibold" x-text="getViewTitle()"></h2>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-slate-400">
                        <span x-text="user.username"></span> ‚Ä¢ Local Deployment
                    </div>
                    <button @click="logout()" class="text-slate-400 hover:text-white">
                        üö™ Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" class="p-6">
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <div class="text-slate-400 text-sm mb-2">Total Portfolio Value</div>
                        <div class="text-2xl font-bold text-white" x-text="formatCurrency(portfolio.total_value)"></div>
                        <div class="flex items-center mt-2">
                            <svg class="w-4 h-4 text-green-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="text-green-400 text-sm">Real-time</span>
                        </div>
                    </div>
                    
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <div class="text-slate-400 text-sm mb-2">Today's P&L</div>
                        <div class="text-2xl font-bold text-green-400" x-text="'+' + formatCurrency(portfolio.daily_pnl)"></div>
                        <div class="text-green-400 text-sm" x-text="'+' + portfolio.daily_pnl_percent + '%'"></div>
                    </div>
                    
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <div class="text-slate-400 text-sm mb-2">Weekly Return</div>
                        <div class="text-2xl font-bold text-green-400" x-text="'+' + portfolio.weekly_return + '%'"></div>
                        <div class="flex items-center mt-2">
                            <svg class="w-4 h-4 text-green-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            <span class="text-green-400 text-sm">Trending up</span>
                        </div>
                    </div>
                    
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <div class="text-slate-400 text-sm mb-2">Active Positions</div>
                        <div class="text-2xl font-bold text-white" x-text="portfolio.active_positions"></div>
                        <div class="flex items-center mt-2">
                            <svg class="w-4 h-4 text-blue-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <span class="text-blue-400 text-sm">Optimized</span>
                        </div>
                    </div>
                </div>

                <!-- Current Positions and System Status -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Current Positions -->
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <h3 class="text-lg font-semibold mb-4">Current Positions</h3>
                        <div class="space-y-3">
                            <template x-for="position in portfolio.positions" :key="position.symbol">
                                <div class="bg-slate-700 p-4 rounded-md">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <div class="font-medium" x-text="position.symbol"></div>
                                            <div class="text-sm text-slate-400" x-text="position.type + ' $' + position.strike + ' ' + position.expiry"></div>
                                        </div>
                                        <div class="text-right">
                                            <div :class="position.pnl >= 0 ? 'text-green-400' : 'text-red-400'" 
                                                 x-text="(position.pnl >= 0 ? '+' : '') + '$' + position.pnl"></div>
                                            <div :class="position.pnl_percent >= 0 ? 'text-green-400' : 'text-red-400'" 
                                                 class="text-sm" x-text="(position.pnl_percent >= 0 ? '+' : '') + position.pnl_percent + '%'"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between text-sm text-slate-400">
                                        <span>Delta: <span x-text="position.delta"></span></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                        <h3 class="text-lg font-semibold mb-4">System Status</h3>
                        <div class="space-y-3">
                            <template x-for="(status, component) in portfolio.system_status" :key="component">
                                <div class="flex justify-between items-center">
                                    <span class="capitalize" x-text="component.replace('_', ' ')"></span>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                                        <span class="text-green-400 text-sm" x-text="status"></span>
                                    </div>
                                </div>
                            </template>
                            
                            <div class="border-t border-slate-600 pt-3 mt-4">
                                <div class="flex justify-between items-center">
                                    <span>Portfolio Delta</span>
                                    <span class="text-white font-medium" x-text="portfolio.system_status.portfolio_delta"></span>
                                </div>
                                <div class="text-xs text-slate-400 mt-1">Within target range (-0.15 to -0.45)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant View -->
            <div x-show="currentView === 'ai'" class="p-6 h-full flex flex-col">
                <div class="bg-slate-800 rounded-lg border border-slate-700 flex-1 flex flex-col">
                    <div class="p-4 border-b border-slate-700">
                        <h3 class="text-lg font-semibold">AI Assistant</h3>
                        <p class="text-sm text-slate-400">Natural language interface ‚Ä¢ Advisory Mode ‚Ä¢ English</p>
                        <div class="inline-block bg-teal-600 text-white text-xs px-2 py-1 rounded mt-2">ADVISORY ONLY</div>
                    </div>
                    
                    <div class="flex-1 p-4 overflow-y-auto">
                        <div class="space-y-4">
                            <!-- Welcome Message -->
                            <div class="flex items-start">
                                <div class="w-8 h-8 bg-teal-600 rounded-full flex items-center justify-center mr-3 mt-1">
                                    <span class="text-white text-sm">AI</span>
                                </div>
                                <div class="flex-1">
                                    <div class="bg-slate-700 p-3 rounded-lg">
                                        <p>Good morning! Your portfolio is performing well today. The Generation Account is up 0.4% and all positions are within optimal risk parameters. How can I assist you today?</p>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-1">09:15 AM</div>
                                </div>
                            </div>
                            
                            <!-- Chat Messages -->
                            <template x-for="message in chatMessages" :key="message.id">
                                <div class="flex items-start" :class="message.sender === 'user' ? 'justify-end' : ''">
                                    <div x-show="message.sender === 'ai'" class="w-8 h-8 bg-teal-600 rounded-full flex items-center justify-center mr-3 mt-1">
                                        <span class="text-white text-sm">AI</span>
                                    </div>
                                    <div class="flex-1 max-w-xs lg:max-w-md">
                                        <div :class="message.sender === 'user' ? 'bg-blue-600 text-white' : 'bg-slate-700'" 
                                             class="p-3 rounded-lg">
                                            <p x-text="message.content"></p>
                                        </div>
                                        <div class="text-xs text-slate-400 mt-1" x-text="message.timestamp"></div>
                                    </div>
                                    <div x-show="message.sender === 'user'" class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center ml-3 mt-1">
                                        <span class="text-white text-sm">U</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div class="p-4 border-t border-slate-700">
                        <form @submit.prevent="sendMessage()" class="flex space-x-2">
                            <input type="text" x-model="newMessage" 
                                   class="flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                                   placeholder="Ask me anything about your portfolio..." required>
                            <button type="submit" 
                                    class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-md transition duration-200">
                                Send
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Other Views (Placeholders) -->
            <div x-show="currentView === 'trading'" class="p-6 flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="text-6xl mb-4">üìà</div>
                    <h3 class="text-xl font-semibold mb-2">Trading Interface</h3>
                    <p class="text-slate-400">Advanced trading interface coming soon...</p>
                </div>
            </div>

            <div x-show="currentView === 'accounts'" class="p-6 flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="text-6xl mb-4">üè¶</div>
                    <h3 class="text-xl font-semibold mb-2">Account Management</h3>
                    <p class="text-slate-400">Account management interface coming soon...</p>
                </div>
            </div>

            <div x-show="currentView === 'risk'" class="p-6 flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="text-6xl mb-4">üõ°Ô∏è</div>
                    <h3 class="text-xl font-semibold mb-2">Risk Management</h3>
                    <p class="text-slate-400">Risk management dashboard coming soon...</p>
                </div>
            </div>

            <div x-show="currentView === 'settings'" class="p-6 flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="text-6xl mb-4">‚öôÔ∏è</div>
                    <h3 class="text-xl font-semibold mb-2">Settings</h3>
                    <p class="text-slate-400">System settings coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                isLoggedIn: false,
                currentView: 'dashboard',
                user: {},
                credentials: {
                    username: '',
                    password: ''
                },
                portfolio: {
                    total_value: 0,
                    daily_pnl: 0,
                    daily_pnl_percent: 0,
                    weekly_return: 0,
                    active_positions: 0,
                    positions: [],
                    system_status: {}
                },
                chatMessages: [],
                newMessage: '',

                async login() {
                    try {
                        const response = await fetch('/api/auth/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.credentials)
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.user = data.user;
                            this.isLoggedIn = true;
                            localStorage.setItem('token', data.access_token);
                            await this.loadPortfolio();
                        } else {
                            alert('Invalid credentials');
                        }
                    } catch (error) {
                        alert('Login failed');
                    }
                },

                logout() {
                    this.isLoggedIn = false;
                    this.user = {};
                    this.credentials = { username: '', password: '' };
                    localStorage.removeItem('token');
                },

                async loadPortfolio() {
                    try {
                        const response = await fetch('/api/portfolio');
                        if (response.ok) {
                            this.portfolio = await response.json();
                        }
                    } catch (error) {
                        console.error('Failed to load portfolio:', error);
                    }
                },

                async sendMessage() {
                    if (!this.newMessage.trim()) return;

                    // Add user message
                    this.chatMessages.push({
                        id: Date.now(),
                        sender: 'user',
                        content: this.newMessage,
                        timestamp: new Date().toLocaleTimeString()
                    });

                    const userMessage = this.newMessage;
                    this.newMessage = '';

                    try {
                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ message: userMessage })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.chatMessages.push({
                                id: Date.now() + 1,
                                sender: 'ai',
                                content: data.response,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    } catch (error) {
                        this.chatMessages.push({
                            id: Date.now() + 1,
                            sender: 'ai',
                            content: 'Sorry, I encountered an error. Please try again.',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                },

                formatCurrency(amount) {
                    return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                },

                getViewTitle() {
                    const titles = {
                        dashboard: 'Dashboard',
                        trading: 'Trading',
                        accounts: 'Accounts',
                        risk: 'Risk Management',
                        ai: 'AI Assistant',
                        settings: 'Settings'
                    };
                    return titles[this.currentView] || 'Dashboard';
                }
            }
        }
    </script>
</body>
</html>

